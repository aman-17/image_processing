<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<cat xmlns="urn:apple:names:siri:cat:1.0" id="SearchCallHistory#ReadCallRecord" locale="en">
    <conditions>        
        <condition name="hasMultipleCalls" note="check whether number of calls in a call record are more than one">
            <expression name="callRecord.numberOfCalls" op="gt" value="1"/>
        </condition>
        
        <condition name="isCallerNeeded">
            <and>
            <expression name="callRecord.caller" op="defined"/>
            <not><expression name="intent.recipient.list.length" op="gt" value="0"/></not>
            </and>
        </condition>
        
        <condition name="shouldMentionMissed" note="We should only mention missed if any of these conditions are true">
            <and>
                <not><expression name="intent.isRequestForMissed"/></not>
                <expression name="callRecord.callRecordType" op="eq" value="'MISSED'"/>
            </and>
        </condition>
        
        <condition name="isDateNeeded">
            <expression name="callRecord.dateCreated" op="defined"/>
        </condition>
        
        <condition name="shouldReadTimeOnly">
            <and>
                <expression name="callRecord.dateCreated" op="defined"/>
                <or>
                    <expression name="callRecord.dateCreated.isToday"/>
                    <expression name="isSingleDateRequest"/>
                    <expression name="isTimeRangeRequest"/>
                </or>
            </and>
        </condition>
        
    </conditions>
    <phrases>
        <first phrase="intro">
            <text condition="hasMultipleCalls"><var name="callRecord.numberOfCalls" number="asWords"/> calls</text>
            <text>a call</text>
        </first>
        
        <first phrase="missedCallIntro">
            <text condition="hasMultipleCalls"><var name="callRecord.numberOfCalls" number="asWords"/> missed calls</text>
            <text>a missed call</text>
        </first>
        
        <first phrase="summary">
            <text condition="shouldMentionMissed"><phrase name="missedCallIntro"/></text>
            <text><phrase name="intro"/></text>
        </first>
        
        <first phrase="summaryWithConjunction">
            <text condition="isLastOfGroup">And, <phrase name="summary"/></text>
            <text><transform mode="capitalizeFirst"><phrase name="summary"/></transform></text>
        </first>
        
        <switch phrase="contactRole" value="callRecord.callRecordType">
            <text case="'VOICEMAIL'"> from </text>
            <text case="'RECEIVED'"> from </text>
            <text case="'MISSED'"> from </text>
            <text case="'OUTGOING'"> to </text>
            <text > with </text>
        </switch>
        <first phrase="callerName">
            <text><var name="callRecord.caller"/></text>
            <text>an unknown caller</text>
        </first>
        
        <first phrase="callerInfo">
            <text condition="isCallerNeeded"><phrase name="contactRole"/><phrase name="callerName"/></text>
        </first>
        
        <first phrase="dateTime">
            <text condition="shouldReadTimeOnly"> <var name="callRecord.dateCreated.timeDescriptiveWithPrefix"/></text>
            <text condition="isDateNeeded"> <var name="callRecord.dateCreated.dateTimeDescriptiveWithPrefixOn"/></text>
        </first>
        
        <first phrase="punctuation">
            <text condition="isLastOfGroup">.</text>
            <text>,</text>
        </first>
    </phrases>
  <first>
      <dialog><phrase name="summaryWithConjunction"/><opt><phrase name="callerInfo"/></opt><opt><phrase name="dateTime"/></opt><phrase name="punctuation"/></dialog>
  </first>
</cat>
