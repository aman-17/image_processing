<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<cat xmlns="urn:apple:names:siri:cat:1.5" id="SearchForMessages#ReadSpokenAudioComponent" locale="en">
    <conditions>
        <condition name="needsPrivateConversationIntroduction">
            <and>
                <expression name="spokenContext.conversation.isGroup" op="unset"/>
                <expression name="spokenContext.conversation.isFirstComponentInConversation" op="set"/>
                <expression name="spokenContext.shouldSpecifyPrivateConversation" op="unset"/>
                <expression name="spokenContext.useAppendedConnector" op="unset"/>
            </and>
        </condition>
        
        <condition name="needAndConnector" note="Possible cases: 1. Shayan said hi and sent a song 2. Bill sent a song and Daniel sent a song 3. Dave sent a song and Bill sent an image and a song">
            <or>
                <and>
                    <expression name="componentContext.isFirstComponentFromSender" op="set"/>
                    <expression name="componentContext.isFirstSender" op="unset"/>
                </and>
                
                <and>
                    <expression name="componentContext.isFirstComponentFromSender" op="unset"/>
                    <or>
                        <expression name="componentContext.isPreviousComponentOfSameType" op="unset"/>
                        <expression name="componentContext.isLastComponentFromSender" op="set"/>
                    </or>
                </and>
            </or>
        </condition>
        
        <condition name="isMultiple">
            <expression name="count" op="gt" value="1"/>
        </condition>
        
        <condition name="includeGroup">
            <and>
                <expression name="spokenContext.conversation.isGroup" op="set"/>
                <expression name="spokenContext.conversation.isFirstComponentInConversation" op="set"/>
            </and>
        </condition>
        
        <condition name="hasUsableGroupName">
            <and>
                <expression name="spokenContext.conversation.group.speakableGroupName" op="nonempty"/>
                <expression name="spokenContext.conversation.group.speakableGroupName.length" op="lt" value="36"/>
            </and>
        </condition>
        
        <condition name="useAThird">
            <expression name="spokenContext.sameConsecutiveComponentTypeCount" op="eq" value="3"/>
        </condition>
        
        <condition name="useAnother">
            <or>
                <expression name="spokenContext.sameConsecutiveComponentTypeCount" op="eq" value="2"/>
                <expression name="spokenContext.sameConsecutiveComponentTypeCount" op="gt" value="3"/>
            </or>
        </condition>
        
        <condition name="needDeterminer" note="This is an OR of useAThird and useAnother">
            <or>
                <expression name="spokenContext.sameConsecutiveComponentTypeCount" op="eq" value="3"/>
                <or>
                    <expression name="spokenContext.sameConsecutiveComponentTypeCount" op="eq" value="2"/>
                    <expression name="spokenContext.sameConsecutiveComponentTypeCount" op="gt" value="3"/>
                </or>
            </or>
        </condition>

        <condition name="hasEffectOrUnplayable">
            <or>
                <and>
                    <expression name="effect" op="defined"/>
                    <expression name="effect" op="ne" value="'unknown'"/>
                </and>
                <expression name="shouldSummarize" op="set"/>
            </or>
        </condition>
    </conditions>
    
    <phrases>
        <first phrase="componentConnector">
            <text condition="needAndConnector">and </text>
            <random condition="spokenContext.useAppendedConnector">
                <text>and </text>
                <text>also </text>
            </random>
        </first>
        
        <first condition="componentContext.isFirstComponentFromSender" phrase="sender">
            <text condition="sender"><var name="sender"/> </text>
            <text>someone </text>
        </first>
        
        <first phrase="componentDescription">
            <first condition="needDeterminer">
                <text condition="useAThird">sent a third audio message</text>
                <text condition="isMultiple">sent another <var name="count"/> audio messages </text>
                <text>sent another audio message </text>
            </first>
            <first condition="hasEffectOrUnplayable">
                <text condition="isMultiple">sent <var name="count"/> audio messages </text>
                <text>sent an audio message </text>
            </first>
            <text condition="needsPrivateConversationIntroduction">says </text>
            <text>said </text>
        </first>
        
        <first phrase="effect">
            <switch value="effect">
                <text case="'confetti'">with a confetti effect </text>
                <text case="'echo'">with an echo effect </text>
                <text case="'fireworks'">with a fireworks effect </text>
                <text case="'gentle'">with a gentle effect </text>
                <text case="'happyBirthday'">with a balloons effect </text>
                <text case="'heart'">with a love effect </text>
                <text case="'impact'">with a slam effect </text>
                <text case="'invisibleInk'">with an invisible ink effect </text>
                <text case="'lasers'">with a laser effect </text>
                <text case="'loud'">with a loud effect </text>
                <text case="'shootingStar'">with a shooting star effect </text>
                <text case="'sparkles'">with a celebration effect </text>
                <text case="'spotlight'">with a spotlight effect </text>
            </switch>
        </first>
        
        <first condition="includeGroup" phrase="referenceGroup">
            <text condition="hasUsableGroupName">to <var name="spokenContext.conversation.group.speakableGroupName"/></text>
            <text condition="spokenContext.shouldShortenGroupMembership">to the group </text>
            <switch value="spokenContext.conversation.group.numberOfMembersOtherThanYouMinusOne">
                <text case="1">to you and <var name="spokenContext.conversation.group.membersOtherThanYouAndSender[0]"/></text>
                <text case="2">to you, <var name="spokenContext.conversation.group.membersOtherThanYouAndSender[0]"/> and <var name="spokenContext.conversation.group.membersOtherThanYouAndSender[1]"/></text>
                <text case="3">to you, <var name="spokenContext.conversation.group.membersOtherThanYouAndSender[0]"/>, <var name="spokenContext.conversation.group.membersOtherThanYouAndSender[1]"/>, and <var name="spokenContext.conversation.group.membersOtherThanYouAndSender[2]"/></text>
            </switch>
            <text>to a group</text>
        </first>
        
        <first condition="spokenContext.shouldSpecifyPrivateConversation" phrase="specifyPrivateThread">
            <text>to you privately</text>
        </first>
    </phrases>
    
    <all>
        <dialog>
            <opt><phrase name="componentConnector"/></opt>
            <opt><phrase name="sender"/></opt>
            <phrase name="componentDescription"/>
            <opt><phrase name="effect"/></opt>
            <opt><phrase name="referenceGroup"/></opt><opt><phrase name="specifyPrivateThread"/></opt>
        </dialog>
    </all>
</cat>

